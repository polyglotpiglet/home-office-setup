---
- hosts: dev
  vars:
    - home_dir: /Users/alexbate/
    - applications: # these will be installed with brew cask idempotently
       - iterm2
       - intellij-idea-ce
       - java
       - haskell-platform
       - spectacle
       - telegram

  tasks:
    - name: Enable installing specific versions of casks (eg for intellij-idea-ce rather than intellij-idea)
      shell: brew tap caskroom/versions

    - name: Check for installed apps(casks)
      shell: brew cask list | grep {{ item }}
      register: installed_applications
      with_items: "{{ applications }}"
      ignore_errors: true

    - name: Install apps with brew-cask   
      shell: brew cask install {{ item }}
      with_items: "{{ applications }}"
      when: item not in installed_applications.results|map(attribute='stdout')

    - name: install brew packages
      homebrew: update_homebrew=yes name={{ item }}
      with_items:
        - npm
        - nvm
        - vcsh
        - mr
        - maven
        - htop
        - wget
        - scala
        - sbt
        - tig
        - python
        - tmux
        - zsh
        - zsh-completions
        - tree
        - watch
        - couchdb
        - postgresql
      tags:
        - brew

    - name: configure intellij
      tags: 
        - intellij
      shell: brew cask info intellij-idea-ce | sed -n 4p | cut -d ' ' -f 1
      register: intellij_idea_ce_dir
    - debug: msg="{{ intellij_idea_ce_dir.stdout }}"
      tags: 
        - intellij
      #register: intellij-idea-ce-homedir
#      tags:
#        - intellij
#    - debug: 
#        var: intellij-idea-ce-homedir
      #copy: src=ideac dest=
